<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/editevent.css">
    <link rel="stylesheet" href="css/header.css">
    <script src="js/header.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.0.1/firebase-firestore.js"></script>
    <script src="js/mydb.js"></script>
    <script src="js/events.js"></script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAAc36s7FZgWYx1RmTW8Yvk131I1S0r7S0&libraries=places"></script>
    <title>Event Editor</title>
</head>
<body>
    <header>
        <div id="navBar">
            <div class="left">
                <a href="index.html"><img id="logo" src="images/EventRexBlank.png"/></a>
                <a class="navButton" href="index.html">HOME</a>
                <a class="navButton active" href="editevent.html">NEW EVENT</a>
                <a class="navButton" href="search.html">SEARCH</a>
                <a class="navButton" href="faq.html">FAQS</a>
            </div>
            <div class="right">
                <a class="navButton" href="profile.html">
                    <img src="images/user.jpg" id="userIcon"/>
                    <span id="profileName"></span> 
                    <script>
                        document.getElementById('userIcon').src=sessionStorage.getItem('iconurl');
                        document.getElementById('profileName').innerText = sessionStorage.getItem('username');
                    </script>
                </a>
            </div>
        </div>
    </header>

    <form action="index.html" id="eventForm" onsubmit="events.SubmitEventForm(this)">
        <div class="inputContainer" style="margin-top: 7em">
            <label for="eventName" class="inputLabel">Event name: </label>
            <input id="eventName" name="name" class="eventInput" type="text" required/>
        </div>
        
        <div class="inputContainer">
            <label class="inputLabel">Categories: </label>
            <div class="categoryGrid">
                <label class="categoryLabel">
                    <input type="radio" name="category" id="party" class="categoryRadio"/>
                    <img src="images/IconPARTY.png" alt="Party"/>
                    <h3>Party</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="campus" class="categoryRadio"/>
                    <img src="images/IconCAMPUS.png" alt="Campus"/>
                    <h3>Campus</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="games" class="categoryRadio"/>
                    <img src="images/IconGames.png" alt="Games"/>
                    <h3>Games</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="outdoors" class="categoryRadio"/>
                    <img src="images/IconOUTDOORS.png" alt="Outdoors"/>
                    <h3>Outdoors</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="gettogether" class="categoryRadio"/>
                    <img src="images/IconGETTOGETHER.png" alt="Get Together"/>
                    <h3>Get-Together</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="sport" class="categoryRadio"/>
                    <img src="images/IconSPORT.png" alt="Sports"/>
                    <h3>Sports</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="service" class="categoryRadio"/>
                    <img src="images/IconSERVICE.png" alt="Service"/>
                    <h3>Service</h3>
                </label>
                <label class="categoryLabel">
                    <input type="radio" name="category" id="etc" class="categoryRadio"/>
                    <img src="images/IconETC.png" alt="Miscellaneous"/>
                    <h3>Miscellaneous</h3>
                </label>
            </div>
        </div>

        <div class="inputContainer">
            <label class="inputLabel">Date: </label>
            <input id="eventDate" name="date" class="eventInput" type="date"/>
            <label class="inputLabel">Location: </label>
            <input id="addressAutocomplete" name="address" type="text" class="eventInput"/>
            <label class="inputLabel">Description: </label>
            <textarea id="eventDesc" name="desc" class="eventInput"></textarea>

            <input type="submit" id="eventSubmit" value="Create Event!"/>

            <script>
                window.addEventListener('load', function() {
                    let addressField = document.getElementById('addressAutocomplete');

                    navigator.geolocation.getCurrentPosition(function(position) {
                        let lat = position.coords.latitude;
                        let long = position.coords.longitude;
                        // Create a bounding box with sides about 5km away from the current location
                        const myBounds = {
                            north: lat + 0.05,
                            south: lat - 0.05,
                            east: long + 0.05,
                            west: long - 0.05,
                        };

                        autocomplete = new google.maps.places.Autocomplete(addressField, {
                            bounds: myBounds,
                            componentRestrictions: { country: "us" },
                            fields: ["formatted_address"],
                            types: ["address"],
                        });
                    });

                    // Fill the fields if there are values in the URL
                    let cgi = new URLSearchParams(window.location.search);
                    let eventID = cgi.get('id');
                    if (eventID) {
                        let eventForm = document.getElementById('eventForm');
                        eventForm.onsubmit = function() { events.UpdateEvent(eventID, eventForm) };

                        events.GetEventData(eventID, eventData => {
                            document.getElementById('eventName').value = eventData.name;
                            document.getElementById(eventData.category).checked = true;
                            document.getElementById('eventDate').value = eventData.date;
                            addressField.value = eventData.address;
                            document.getElementById('eventDesc').value = eventData.desc;
                            document.getElementById('eventSubmit').value = 'Update Event!';
                        });
                    }
                });
            </script>

        </div>
    </form>
</body>
</html>